<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HTML to Markdown Bookmarklet - GitHub Ready</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            background: rgba(255, 255, 255, 0.98);
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            padding: 40px;
            max-width: 1000px;
            margin: 0 auto;
        }

        h1 {
            text-align: center;
            color: #333;
            margin-bottom: 10px;
            font-size: 2.5rem;
            background: linear-gradient(135deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .subtitle {
            text-align: center;
            color: #666;
            margin-bottom: 40px;
            font-size: 1.1rem;
        }

        .bookmarklet-section {
            background: #f8f9fa;
            border: 2px solid #e9ecef;
            border-radius: 15px;
            padding: 30px;
            margin: 30px 0;
        }

        .bookmarklet-title {
            font-size: 1.4rem;
            color: #333;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .bookmarklet-link {
            background: linear-gradient(135deg, #28a745, #20c997);
            color: white;
            text-decoration: none;
            padding: 15px 25px;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            display: inline-block;
            margin: 10px 0;
            transition: all 0.3s ease;
            cursor: move;
        }

        .bookmarklet-link:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(40, 167, 69, 0.3);
            color: white;
            text-decoration: none;
        }

        .instructions {
            background: #e7f3ff;
            border: 1px solid #b3d9ff;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
        }

        .instructions h3 {
            color: #0066cc;
            margin-bottom: 15px;
        }

        .instructions ol {
            color: #333;
            line-height: 1.6;
            padding-left: 20px;
        }

        .instructions li {
            margin: 8px 0;
        }

        .code-block {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 8px;
            padding: 15px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            overflow-x: auto;
            margin: 15px 0;
            white-space: pre-wrap;
            word-break: break-all;
        }

        .warning {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
            color: #856404;
        }

        .github-section {
            background: #f6f8fa;
            border: 2px solid #d0d7de;
            border-radius: 15px;
            padding: 30px;
            margin: 30px 0;
        }

        .copy-btn {
            background: #0969da;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            margin: 10px 0;
        }

        .copy-btn:hover {
            background: #0860ca;
        }

        @media (max-width: 768px) {
            .container {
                padding: 20px;
                margin: 10px;
            }
            
            h1 {
                font-size: 2rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>HTML ‚Üí Markdown</h1>
        <p class="subtitle">Bookmarklet –¥–ª—è —à–≤–∏–¥–∫–æ—ó –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü—ñ—ó –≤–µ–±-—Å—Ç–æ—Ä—ñ–Ω–æ–∫</p>

        <div class="bookmarklet-section">
            <div class="bookmarklet-title">
                <span>üîñ</span> Bookmarklet –¥–ª—è –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è
            </div>
            
            <p style="margin-bottom: 15px; color: #666;">
                –ü–µ—Ä–µ—Ç—è–≥–Ω—ñ—Ç—å —Ü—é –∫–Ω–æ–ø–∫—É –Ω–∞ –ø–∞–Ω–µ–ª—å –∑–∞–∫–ª–∞–¥–æ–∫ –≤–∞—à–æ–≥–æ –±—Ä–∞—É–∑–µ—Ä–∞:
            </p>
            
            <a href="javascript:(function(){const overlay=document.createElement('div');overlay.style.cssText='position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.9);z-index:999999;display:flex;align-items:center;justify-content:center;backdrop-filter:blur(3px);';const container=document.createElement('div');container.style.cssText='background:white;border-radius:20px;padding:40px;max-width:900px;max-height:90vh;overflow-y:auto;box-shadow:0 25px 50px rgba(0,0,0,0.4);position:relative;';const closeBtn=document.createElement('button');closeBtn.innerHTML='‚ùå';closeBtn.style.cssText='position:absolute;top:15px;right:15px;background:none;border:none;font-size:20px;cursor:pointer;padding:5px;';closeBtn.onclick=()=>document.body.removeChild(overlay);const title=document.createElement('h2');title.innerHTML='HTML ‚Üí Markdown Converter';title.style.cssText='text-align:center;color:#333;margin-bottom:20px;background:linear-gradient(135deg,#667eea,#764ba2);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;';const resultArea=document.createElement('textarea');resultArea.style.cssText='width:100%;height:400px;padding:20px;border:2px solid #e0e0e0;border-radius:12px;font-family:Courier New,monospace;font-size:14px;line-height:1.6;resize:vertical;margin:20px 0;';resultArea.readOnly=true;resultArea.placeholder='–ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü—ñ—è –≤ –ø—Ä–æ—Ü–µ—Å—ñ...';const copyBtn=document.createElement('button');copyBtn.innerHTML='üìã –ö–æ–ø—ñ—é–≤–∞—Ç–∏ Markdown';copyBtn.style.cssText='background:linear-gradient(135deg,#28a745,#20c997);color:white;border:none;padding:15px 25px;border-radius:10px;font-size:16px;font-weight:600;cursor:pointer;margin:10px;';const downloadBtn=document.createElement('button');downloadBtn.innerHTML='üíæ –ó–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ —Ñ–∞–π–ª';downloadBtn.style.cssText='background:linear-gradient(135deg,#007bff,#0056b3);color:white;border:none;padding:15px 25px;border-radius:10px;font-size:16px;font-weight:600;cursor:pointer;margin:10px;';const statsDiv=document.createElement('div');statsDiv.style.cssText='color:#666;font-size:14px;margin:10px 0;';container.appendChild(closeBtn);container.appendChild(title);container.appendChild(resultArea);container.appendChild(statsDiv);container.appendChild(copyBtn);container.appendChild(downloadBtn);overlay.appendChild(container);document.body.appendChild(overlay);function logDiagnostic(message){console.log(message);}function cleanHTML(doc){logDiagnostic('üßπ –ü–æ—á–∏–Ω–∞—î–º–æ –æ—á–∏—â–µ–Ω–Ω—è HTML...');const elementsToRemove=['style','script','link','meta','noscript','iframe','object','embed','audio','video','canvas','svg','head'];let removedCount=0;elementsToRemove.forEach(tagName=>{const elements=doc.querySelectorAll(tagName);elements.forEach(element=>{element.remove();removedCount++;});});logDiagnostic(`üóëÔ∏è –í–∏–¥–∞–ª–µ–Ω–æ ${removedCount} —Ç–µ—Ö–Ω—ñ—á–Ω–∏—Ö –µ–ª–µ–º–µ–Ω—Ç—ñ–≤`);const allElements=doc.querySelectorAll('*');let cleanedAttributes=0;allElements.forEach(element=>{const attributesToRemove=['style','class','id','onclick','onload','onmouseover','onmouseout','onfocus','onblur','onchange','onsubmit','data-*'];attributesToRemove.forEach(attr=>{if(attr==='data-*'){const attributes=Array.from(element.attributes);attributes.forEach(attribute=>{if(attribute.name.startsWith('data-')){element.removeAttribute(attribute.name);cleanedAttributes++;}});}else if(element.hasAttribute(attr)){element.removeAttribute(attr);cleanedAttributes++;}});});logDiagnostic(`üßΩ –û—á–∏—â–µ–Ω–æ ${cleanedAttributes} –∞—Ç—Ä–∏–±—É—Ç—ñ–≤`);const allElementsAfterClean=doc.querySelectorAll('*');let removedEmptyElements=0;allElementsAfterClean.forEach(element=>{const tagName=element.tagName.toLowerCase();const allowedEmptyElements=['br','hr','img','input','area','base','col','embed','source','track','wbr'];if(!allowedEmptyElements.includes(tagName)&&!element.textContent.trim()&&element.children.length===0){element.remove();removedEmptyElements++;}});logDiagnostic(`üóëÔ∏è –í–∏–¥–∞–ª–µ–Ω–æ ${removedEmptyElements} –ø–æ—Ä–æ–∂–Ω—ñ—Ö –µ–ª–µ–º–µ–Ω—Ç—ñ–≤`);logDiagnostic('‚úÖ –û—á–∏—â–µ–Ω–Ω—è HTML –∑–∞–≤–µ—Ä—à–µ–Ω–æ');return doc;}function findBestContent(doc){logDiagnostic('üîç –®—É–∫–∞—î–º–æ H1 –¥–ª—è –ø–æ—á–∞—Ç–∫—É –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü—ñ—ó...');const h1=doc.querySelector('h1');if(!h1){logDiagnostic('‚ùå H1 –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ, –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î–º–æ fallback');return findFallbackContent(doc);}logDiagnostic(`‚úÖ –ó–Ω–∞–π–¥–µ–Ω–æ H1: \"${h1.textContent.trim()}\"`);const container=document.createElement('div');container.appendChild(h1.cloneNode(true));let currentElement=h1;while(currentElement.nextElementSibling){currentElement=currentElement.nextElementSibling;container.appendChild(currentElement.cloneNode(true));logDiagnostic(`‚ûï –î–æ–¥–∞–Ω–æ –µ–ª–µ–º–µ–Ω—Ç –ø—ñ—Å–ª—è H1: ${currentElement.tagName}`);}let parentContainer=h1.parentElement;if(parentContainer&&parentContainer!==doc.body){let nextContainer=parentContainer;while(nextContainer.nextElementSibling){nextContainer=nextContainer.nextElementSibling;if(nextContainer.textContent.trim().length>50){container.appendChild(nextContainer.cloneNode(true));logDiagnostic(`‚ûï –î–æ–¥–∞–Ω–æ –Ω–∞—Å—Ç—É–ø–Ω–∏–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä: ${nextContainer.tagName}`);}}}logDiagnostic(`‚úÖ –°—Ç–≤–æ—Ä–µ–Ω–æ –∫–æ–Ω—Ç–µ–Ω—Ç –ø–æ—á–∏–Ω–∞—é—á–∏ –∑ H1: ${container.textContent.length} —Å–∏–º–≤–æ–ª—ñ–≤`);return container;}function findFallbackContent(doc){const contentSelectors=['article','main','.content','.post-content','.entry-content','#content'];let contentElement=null;let maxTextLength=0;for(const selector of contentSelectors){const elements=doc.querySelectorAll(selector);elements.forEach(element=>{const textLength=element.textContent.trim().length;logDiagnostic(`üîç Fallback –ø–µ—Ä–µ–≤—ñ—Ä–∫–∞ ${selector}: ${textLength} —Å–∏–º–≤–æ–ª—ñ–≤`);if(textLength>maxTextLength&&textLength>1000){maxTextLength=textLength;contentElement=element;}});}if(contentElement){logDiagnostic(`‚úÖ Fallback –≤–∏–±—Ä–∞–Ω–æ: ${maxTextLength} —Å–∏–º–≤–æ–ª—ñ–≤`);return contentElement;}logDiagnostic('üîÑ –û—Å—Ç–∞–Ω–Ω—ñ–π fallback: –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î–º–æ body');return doc.body;}function convertElement(element){let markdown='';let processedNodes=0;logDiagnostic(`üîÑ convertElement: ${element.childNodes.length} –¥–æ—á—ñ—Ä–Ω—ñ—Ö –≤—É–∑–ª—ñ–≤`);for(let i=0;i<element.childNodes.length;i++){const child=element.childNodes[i];if(child.nodeType===Node.TEXT_NODE){const text=child.textContent.replace(/\s+/g,' ').trim();if(text){markdown+=text+' ';processedNodes++;}}else if(child.nodeType===Node.ELEMENT_NODE){const elementResult=convertHTMLElement(child);markdown+=elementResult;if(elementResult)processedNodes++;}}logDiagnostic(`‚úÖ convertElement –∑–∞–≤–µ—Ä—à–µ–Ω–æ: ${processedNodes} –≤—É–∑–ª—ñ–≤, ${markdown.length} —Å–∏–º–≤–æ–ª—ñ–≤`);return markdown;}function convertHTMLElement(element){const tagName=element.tagName.toLowerCase();const text=element.textContent.trim();if(!text&&!['img','hr','br','table'].includes(tagName))return '';switch(tagName){case 'h1':return `\n# ${text}\n\n`;case 'h2':return `\n## ${text}\n\n`;case 'h3':return `\n### ${text}\n\n`;case 'h4':return `\n#### ${text}\n\n`;case 'h5':return `\n##### ${text}\n\n`;case 'h6':return `\n###### ${text}\n\n`;case 'p':return `\n${convertElement(element)}\n\n`;case 'strong':case 'b':return `**${text}**`;case 'em':case 'i':return `*${text}*`;case 'code':return `\`${text}\``;case 'pre':const codeElement=element.querySelector('code');const codeText=codeElement?codeElement.textContent:text;return `\n\`\`\`\n${codeText}\n\`\`\`\n\n`;case 'a':const href=element.getAttribute('href');if(!href||href.startsWith('#')||href===''||href.startsWith('javascript:')||href.includes('#')){return text;}return `[${text}](${href})`;case 'img':const src=element.getAttribute('src');const alt=element.getAttribute('alt')||'–∑–æ–±—Ä–∞–∂–µ–Ω–Ω—è';return src?`![${alt}](${src})`:'';case 'ul':return convertList(element,false);case 'ol':return convertList(element,true);case 'li':return convertElement(element);case 'blockquote':return `\n> ${convertElement(element)}\n\n`;case 'table':return convertTable(element);case 'br':return '\n';case 'hr':return '\n---\n\n';default:return convertElement(element);}}function convertList(listElement,isOrdered){let markdown='\n';const items=listElement.querySelectorAll(':scope > li');items.forEach((item,index)=>{const prefix=isOrdered?`${index+1}. `:'- ';const content=convertElement(item).trim();markdown+=`${prefix}${content}\n`;});return markdown+'\n';}function convertTable(table){let markdown='\n';const rows=table.querySelectorAll('tr');if(rows.length===0){logDiagnostic('‚ö†Ô∏è –¢–∞–±–ª–∏—Ü—è –±–µ–∑ —Ä—è–¥–∫—ñ–≤');return '';}logDiagnostic(`üìä –ö–æ–Ω–≤–µ—Ä—Ç—É—î–º–æ —Ç–∞–±–ª–∏—Ü—é: ${rows.length} —Ä—è–¥–∫—ñ–≤`);rows.forEach((row,rowIndex)=>{const cells=row.querySelectorAll('td, th');if(cells.length===0)return;const cellContents=Array.from(cells).map(cell=>{let text=cell.textContent.trim();text=text.replace(/\s+/g,' ');text=text.replace(/\|/g,'\\|');if(text.length>50){text=text.substring(0,47)+'...';}return text||' ';});markdown+=`| ${cellContents.join(' | ')} |\n`;if(rowIndex===0){const separator='|'+' --- |'.repeat(cells.length)+'\n';markdown+=separator;logDiagnostic(`üìã –î–æ–¥–∞–Ω–æ —Ä–æ–∑–¥—ñ–ª—å–Ω–∏–∫: ${cells.length} –∫–æ–ª–æ–Ω–æ–∫`);}});markdown+='\n';logDiagnostic(`‚úÖ –¢–∞–±–ª–∏—Ü—è –∫–æ–Ω–≤–µ—Ä—Ç–æ–≤–∞–Ω–∞ —É—Å–ø—ñ—à–Ω–æ`);return markdown;}function htmlToMarkdown(doc){logDiagnostic('üîç htmlToMarkdown –ü–û–ß–ê–¢–û–ö');let markdown='';let contentElement=findBestContent(doc);if(!contentElement){logDiagnostic('‚ùå –ù–µ –∑–Ω–∞–π–¥–µ–Ω–æ –∂–æ–¥–Ω–æ–≥–æ –∫–æ–Ω—Ç–µ–Ω—Ç—É');return '';}logDiagnostic('üîÑ –ü–æ—á–∞—Ç–æ–∫ –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü—ñ—ó –µ–ª–µ–º–µ–Ω—Ç—ñ–≤...');const convertedContent=convertElement(contentElement);logDiagnostic(`üìè –ü—ñ—Å–ª—è convertElement, –¥–æ–≤–∂–∏–Ω–∞: ${convertedContent.length}`);markdown+=convertedContent;const trimmedMarkdown=markdown.trim();logDiagnostic(`üèÅ htmlToMarkdown –ó–ê–í–ï–†–®–ï–ù–ù–Ø: ${trimmedMarkdown.length} —Å–∏–º–≤–æ–ª—ñ–≤`);return trimmedMarkdown;}function convertCurrentPage(){try{logDiagnostic('üöÄ –ü–æ—á–∞—Ç–æ–∫ –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü—ñ—ó –ø–æ—Ç–æ—á–Ω–æ—ó —Å—Ç–æ—Ä—ñ–Ω–∫–∏...');const parser=new DOMParser();let doc=parser.parseFromString(document.documentElement.outerHTML,'text/html');logDiagnostic('üîÑ HTML —É—Å–ø—ñ—à–Ω–æ —Å–ø–∞—Ä—Å–µ–Ω–æ');if(!doc||!doc.body){throw new Error('–ù–µ –≤–¥–∞–ª–æ—Å—è —Ä–æ–∑–ø–∞—Ä—Å–∏—Ç–∏ HTML');}doc=cleanHTML(doc);const markdown=htmlToMarkdown(doc);if(!markdown||markdown.trim().length===0){throw new Error('–†–µ–∑—É–ª—å—Ç–∞—Ç –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü—ñ—ó –ø–æ—Ä–æ–∂–Ω—ñ–π');}logDiagnostic(`‚úÖ –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü—ñ—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞: ${markdown.length} —Å–∏–º–≤–æ–ª—ñ–≤`);const charCount=markdown.length;const wordCount=markdown.trim().split(/\s+/).filter(word=>word.length>0).length;const lineCount=markdown.split('\n').length;statsDiv.innerHTML=`<strong>–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞:</strong> ${charCount.toLocaleString()} —Å–∏–º–≤–æ–ª—ñ–≤, ${wordCount.toLocaleString()} —Å–ª—ñ–≤, ${lineCount.toLocaleString()} —Ä—è–¥–∫—ñ–≤`;resultArea.value=markdown;resultArea.placeholder='';copyBtn.onclick=()=>{navigator.clipboard.writeText(markdown).then(()=>{copyBtn.innerHTML='‚úÖ –°–∫–æ–ø—ñ–π–æ–≤–∞–Ω–æ!';setTimeout(()=>copyBtn.innerHTML='üìã –ö–æ–ø—ñ—é–≤–∞—Ç–∏ Markdown',2000);}).catch(()=>{const textarea=document.createElement('textarea');textarea.value=markdown;document.body.appendChild(textarea);textarea.select();document.execCommand('copy');document.body.removeChild(textarea);copyBtn.innerHTML='‚úÖ –°–∫–æ–ø—ñ–π–æ–≤–∞–Ω–æ!';setTimeout(()=>copyBtn.innerHTML='üìã –ö–æ–ø—ñ—é–≤–∞—Ç–∏ Markdown',2000);});};downloadBtn.onclick=()=>{const now=new Date();const timestamp=now.getFullYear()+String(now.getMonth()+1).padStart(2,'0')+String(now.getDate()).padStart(2,'0')+'_'+String(now.getHours()).padStart(2,'0')+String(now.getMinutes()).padStart(2,'0');const fileName=`markdown_${timestamp}.md`;const blob=new Blob([markdown],{type:'text/plain;charset=utf-8'});const url=URL.createObjectURL(blob);const a=document.createElement('a');a.href=url;a.download=fileName;a.click();URL.revokeObjectURL(url);};}catch(error){logDiagnostic(`‚ùå –ü–æ–º–∏–ª–∫–∞: ${error.message}`);statsDiv.innerHTML=`<span style="color:red;">‚ùå –ü–æ–º–∏–ª–∫–∞: ${error.message}</span>`;resultArea.value='';resultArea.placeholder='–°—Ç–∞–ª–∞—Å—è –ø–æ–º–∏–ª–∫–∞ –ø—Ä–∏ –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü—ñ—ó...';}}convertCurrentPage();})()**`;case 'em':case 'i':return `*${text}*`;case 'code':return `\`${text}\``;case 'pre':const codeElement=element.querySelector('code');const codeText=codeElement?codeElement.textContent:text;return `\n\`\`\`\n${codeText}\n\`\`\`\n\n`;case 'a':const href=element.getAttribute('href');if(!href||href.startsWith('#')||href===''||href.startsWith('javascript:')||href.includes('#')){return text;}return `[${text}](${href})`;case 'img':const src=element.getAttribute('src');const alt=element.getAttribute('alt')||'–∑–æ–±—Ä–∞–∂–µ–Ω–Ω—è';return src?`![${alt}](${src})`:'';case 'ul':return convertList(element,false);case 'ol':return convertList(element,true);case 'li':return convertElement(element);case 'blockquote':return `\n> ${convertElement(element)}\n\n`;case 'table':return convertTable(element);case 'br':return '\n';case 'hr':return '\n---\n\n';default:return convertElement(element);}}function convertList(listElement,isOrdered){let markdown='\n';const items=listElement.querySelectorAll(':scope > li');items.forEach((item,index)=>{const prefix=isOrdered?`${index+1}. `:'- ';const content=convertElement(item).trim();markdown+=`${prefix}${content}\n`;});return markdown+'\n';}function convertTable(table){let markdown='\n';const rows=table.querySelectorAll('tr');if(rows.length===0){logDiagnostic('‚ö†Ô∏è –¢–∞–±–ª–∏—Ü—è –±–µ–∑ —Ä—è–¥–∫—ñ–≤');return '';}logDiagnostic(`üìä –ö–æ–Ω–≤–µ—Ä—Ç—É—î–º–æ —Ç–∞–±–ª–∏—Ü—é: ${rows.length} —Ä—è–¥–∫—ñ–≤`);rows.forEach((row,rowIndex)=>{const cells=row.querySelectorAll('td, th');if(cells.length===0)return;const cellContents=Array.from(cells).map(cell=>{let text=cell.textContent.trim();text=text.replace(/\s+/g,' ');text=text.replace(/\|/g,'\\|');if(text.length>50){text=text.substring(0,47)+'...';}return text||' ';});markdown+=`| ${cellContents.join(' | ')} |\n`;if(rowIndex===0){const separator='|'+' --- |'.repeat(cells.length)+'\n';markdown+=separator;logDiagnostic(`üìã –î–æ–¥–∞–Ω–æ —Ä–æ–∑–¥—ñ–ª—å–Ω–∏–∫: ${cells.length} –∫–æ–ª–æ–Ω–æ–∫`);}});markdown+='\n';logDiagnostic(`‚úÖ –¢–∞–±–ª–∏—Ü—è –∫–æ–Ω–≤–µ—Ä—Ç–æ–≤–∞–Ω–∞ —É—Å–ø—ñ—à–Ω–æ`);return markdown;}function htmlToMarkdown(doc){logDiagnostic('üîç htmlToMarkdown –ü–û–ß–ê–¢–û–ö');let markdown='';let contentElement=findBestContent(doc);if(!contentElement){logDiagnostic('‚ùå –ù–µ –∑–Ω–∞–π–¥–µ–Ω–æ –∂–æ–¥–Ω–æ–≥–æ –∫–æ–Ω—Ç–µ–Ω—Ç—É');return '';}logDiagnostic('üîÑ –ü–æ—á–∞—Ç–æ–∫ –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü—ñ—ó –µ–ª–µ–º–µ–Ω—Ç—ñ–≤...');const convertedContent=convertElement(contentElement);logDiagnostic(`üìè –ü—ñ—Å–ª—è convertElement, –¥–æ–≤–∂–∏–Ω–∞: ${convertedContent.length}`);markdown+=convertedContent;const trimmedMarkdown=markdown.trim();logDiagnostic(`üèÅ htmlToMarkdown –ó–ê–í–ï–†–®–ï–ù–ù–Ø: ${trimmedMarkdown.length} —Å–∏–º–≤–æ–ª—ñ–≤`);return trimmedMarkdown;}function convertCurrentPage(){try{logDiagnostic('üöÄ –ü–æ—á–∞—Ç–æ–∫ –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü—ñ—ó –ø–æ—Ç–æ—á–Ω–æ—ó —Å—Ç–æ—Ä—ñ–Ω–∫–∏...');const parser=new DOMParser();let doc=parser.parseFromString(document.documentElement.outerHTML,'text/html');logDiagnostic('üîÑ HTML —É—Å–ø—ñ—à–Ω–æ —Å–ø–∞—Ä—Å–µ–Ω–æ');if(!doc||!doc.body){throw new Error('–ù–µ –≤–¥–∞–ª–æ—Å—è —Ä–æ–∑–ø–∞—Ä—Å–∏—Ç–∏ HTML');}doc=cleanHTML(doc);const markdown=htmlToMarkdown(doc);if(!markdown||markdown.trim().length===0){throw new Error('–†–µ–∑—É–ª—å—Ç–∞—Ç –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü—ñ—ó –ø–æ—Ä–æ–∂–Ω—ñ–π');}logDiagnostic(`‚úÖ –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü—ñ—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞: ${markdown.length} —Å–∏–º–≤–æ–ª—ñ–≤`);const charCount=markdown.length;const wordCount=markdown.trim().split(/\s+/).filter(word=>word.length>0).length;const lineCount=markdown.split('\n').length;statsDiv.innerHTML=`<strong>–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞:</strong> ${charCount.toLocaleString()} —Å–∏–º–≤–æ–ª—ñ–≤, ${wordCount.toLocaleString()} —Å–ª—ñ–≤, ${lineCount.toLocaleString()} —Ä—è–¥–∫—ñ–≤`;resultArea.value=markdown;resultArea.placeholder='';copyBtn.onclick=()=>{navigator.clipboard.writeText(markdown).then(()=>{copyBtn.innerHTML='‚úÖ –°–∫–æ–ø—ñ–π–æ–≤–∞–Ω–æ!';setTimeout(()=>copyBtn.innerHTML='üìã –ö–æ–ø—ñ—é–≤–∞—Ç–∏ Markdown',2000);}).catch(()=>{const textarea=document.createElement('textarea');textarea.value=markdown;document.body.appendChild(textarea);textarea.select();document.execCommand('copy');document.body.removeChild(textarea);copyBtn.innerHTML='‚úÖ –°–∫–æ–ø—ñ–π–æ–≤–∞–Ω–æ!';setTimeout(()=>copyBtn.innerHTML='üìã –ö–æ–ø—ñ—é–≤–∞—Ç–∏ Markdown',2000);});};downloadBtn.onclick=()=>{const now=new Date();const timestamp=now.getFullYear()+String(now.getMonth()+1).padStart(2,'0')+String(now.getDate()).padStart(2,'0')+'_'+String(now.getHours()).padStart(2,'0')+String(now.getMinutes()).padStart(2,'0');const fileName=`markdown_${timestamp}.md`;const blob=new Blob([markdown],{type:'text/plain;charset=utf-8'});const url=URL.createObjectURL(blob);const a=document.createElement('a');a.href=url;a.download=fileName;a.click();URL.revokeObjectURL(url);};}catch(error){logDiagnostic(`‚ùå –ü–æ–º–∏–ª–∫–∞: ${error.message}`);statsDiv.innerHTML=`<span style=\"color:red;\">‚ùå –ü–æ–º–∏–ª–∫–∞: ${error.message}</span>`;resultArea.value='';resultArea.placeholder='–°—Ç–∞–ª–∞—Å—è –ø–æ–º–∏–ª–∫–∞ –ø—Ä–∏ –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü—ñ—ó...';}}convertCurrentPage();})()" 
                  class="bookmarklet-link" 
                  title="–ü–µ—Ä–µ—Ç—è–≥–Ω—ñ—Ç—å –Ω–∞ –ø–∞–Ω–µ–ª—å –∑–∞–∫–ª–∞–¥–æ–∫">
                üîñ HTML ‚Üí Markdown
            </a>

            <div class="instructions">
                <h3>üìñ –Ü–Ω—Å—Ç—Ä—É–∫—Ü—ñ—è –ø–æ –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—é:</h3>
                <ol>
                    <li><strong>–ü–æ–∫–∞–∑–∞—Ç–∏ –ø–∞–Ω–µ–ª—å –∑–∞–∫–ª–∞–¥–æ–∫:</strong> –ù–∞—Ç–∏—Å–Ω—ñ—Ç—å Ctrl+Shift+B (Chrome/Edge) –∞–±–æ Cmd+Shift+B (Safari)</li>
                    <li><strong>–ü–µ—Ä–µ—Ç—è–≥–Ω—É—Ç–∏:</strong> –í—ñ–∑—å–º—ñ—Ç—å –∫–Ω–æ–ø–∫—É "üîñ HTML ‚Üí Markdown" –≤–∏—â–µ —ñ –ø–µ—Ä–µ—Ç—è–≥–Ω—ñ—Ç—å –Ω–∞ –ø–∞–Ω–µ–ª—å –∑–∞–∫–ª–∞–¥–æ–∫</li>
                    <li><strong>–í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è:</strong> –ù–∞ –±—É–¥—å-—è–∫—ñ–π –≤–µ–±-—Å—Ç–æ—Ä—ñ–Ω—Ü—ñ –Ω–∞—Ç–∏—Å–Ω—ñ—Ç—å –Ω–∞ –∑–∞–∫–ª–∞–¥–∫—É —â–æ–± –∫–æ–Ω–≤–µ—Ä—Ç—É–≤–∞—Ç–∏ HTML –≤ Markdown</li>
                </ol>
            </div>

            <div class="warning">
                <strong>‚ö†Ô∏è –í–∞–∂–ª–∏–≤–æ:</strong> Bookmarklet –ø—Ä–∞—Ü—é—î —Ç—ñ–ª—å–∫–∏ –Ω–∞ –∑–≤–∏—á–∞–π–Ω–∏—Ö –≤–µ–±-—Å—Ç–æ—Ä—ñ–Ω–∫–∞—Ö. –ù–µ –ø—Ä–∞—Ü—é—î –Ω–∞ —Å–∏—Å—Ç–µ–º–Ω–∏—Ö —Å—Ç–æ—Ä—ñ–Ω–∫–∞—Ö –±—Ä–∞—É–∑–µ—Ä–∞ (chrome://, about:, —Ç–æ—â–æ).
            </div>
        </div>

        <div class="github-section">
            <div class="bookmarklet-title">
                <span>üìÇ</span> –ö–æ–¥ –¥–ª—è GitHub
            </div>
            
            <p style="margin-bottom: 15px; color: #666;">
                –ú—ñ–Ω—ñ–º—ñ–∑–æ–≤–∞–Ω–∏–π JavaScript –∫–æ–¥ –¥–ª—è —Ä–æ–∑–º—ñ—â–µ–Ω–Ω—è –≤ README.md:
            </p>

            <button class="copy-btn" onclick="copyGitHubCode()">üìã –ö–æ–ø—ñ—é–≤–∞—Ç–∏ –∫–æ–¥ –¥–ª—è GitHub</button>

            <div class="code-block" id="github-code">javascript:(function(){const overlay=document.createElement('div');overlay.style.cssText='position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.9);z-index:999999;display:flex;align-items:center;justify-content:center;backdrop-filter:blur(3px);';const container=document.createElement('div');container.style.cssText='background:white;border-radius:20px;padding:40px;max-width:900px;max-height:90vh;overflow-y:auto;box-shadow:0 25px 50px rgba(0,0,0,0.4);position:relative;';const closeBtn=document.createElement('button');closeBtn.innerHTML='‚ùå';closeBtn.style.cssText='position:absolute;top:15px;right:15px;background:none;border:none;font-size:20px;cursor:pointer;padding:5px;';closeBtn.onclick=()=>document.body.removeChild(overlay);const title=document.createElement('h2');title.innerHTML='HTML ‚Üí Markdown Converter';title.style.cssText='text-align:center;color:#333;margin-bottom:20px;background:linear-gradient(135deg,#667eea,#764ba2);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;';const resultArea=document.createElement('textarea');resultArea.style.cssText='width:100%;height:400px;padding:20px;border:2px solid #e0e0e0;border-radius:12px;font-family:Courier New,monospace;font-size:14px;line-height:1.6;resize:vertical;margin:20px 0;';resultArea.readOnly=true;resultArea.placeholder='–ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü—ñ—è –≤ –ø—Ä–æ—Ü–µ—Å—ñ...';const copyBtn=document.createElement('button');copyBtn.innerHTML='üìã –ö–æ–ø—ñ—é–≤–∞—Ç–∏ Markdown';copyBtn.style.cssText='background:linear-gradient(135deg,#28a745,#20c997);color:white;border:none;padding:15px 25px;border-radius:10px;font-size:16px;font-weight:600;cursor:pointer;margin:10px;';const downloadBtn=document.createElement('button');downloadBtn.innerHTML='üíæ –ó–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ —Ñ–∞–π–ª';downloadBtn.style.cssText='background:linear-gradient(135deg,#007bff,#0056b3);color:white;border:none;padding:15px 25px;border-radius:10px;font-size:16px;font-weight:600;cursor:pointer;margin:10px;';const statsDiv=document.createElement('div');statsDiv.style.cssText='color:#666;font-size:14px;margin:10px 0;';container.appendChild(closeBtn);container.appendChild(title);container.appendChild(resultArea);container.appendChild(statsDiv);container.appendChild(copyBtn);container.appendChild(downloadBtn);overlay.appendChild(container);document.body.appendChild(overlay);function logDiagnostic(message){console.log(message);}function cleanHTML(doc){logDiagnostic('üßπ –ü–æ—á–∏–Ω–∞—î–º–æ –æ—á–∏—â–µ–Ω–Ω—è HTML...');const elementsToRemove=['style','script','link','meta','noscript','iframe','object','embed','audio','video','canvas','svg','head'];let removedCount=0;elementsToRemove.forEach(tagName=>{const elements=doc.querySelectorAll(tagName);elements.forEach(element=>{element.remove();removedCount++;});});logDiagnostic(`üóëÔ∏è –í–∏–¥–∞–ª–µ–Ω–æ ${removedCount} —Ç–µ—Ö–Ω—ñ—á–Ω–∏—Ö –µ–ª–µ–º–µ–Ω—Ç—ñ–≤`);const allElements=doc.querySelectorAll('*');let cleanedAttributes=0;allElements.forEach(element=>{const attributesToRemove=['style','class','id','onclick','onload','onmouseover','onmouseout','onfocus','onblur','onchange','onsubmit','data-*'];attributesToRemove.forEach(attr=>{if(attr==='data-*'){const attributes=Array.from(element.attributes);attributes.forEach(attribute=>{if(attribute.name.startsWith('data-')){element.removeAttribute(attribute.name);cleanedAttributes++;}});}else if(element.hasAttribute(attr)){element.removeAttribute(attr);cleanedAttributes++;}});});logDiagnostic(`üßΩ –û—á–∏—â–µ–Ω–æ ${cleanedAttributes} –∞—Ç—Ä–∏–±—É—Ç—ñ–≤`);const allElementsAfterClean=doc.querySelectorAll('*');let removedEmptyElements=0;allElementsAfterClean.forEach(element=>{const tagName=element.tagName.toLowerCase();const allowedEmptyElements=['br','hr','img','input','area','base','col','embed','source','track','wbr'];if(!allowedEmptyElements.includes(tagName)&&!element.textContent.trim()&&element.children.length===0){element.remove();removedEmptyElements++;}});logDiagnostic(`üóëÔ∏è –í–∏–¥–∞–ª–µ–Ω–æ ${removedEmptyElements} –ø–æ—Ä–æ–∂–Ω—ñ—Ö –µ–ª–µ–º–µ–Ω—Ç—ñ–≤`);logDiagnostic('‚úÖ –û—á–∏—â–µ–Ω–Ω—è HTML –∑–∞–≤–µ—Ä—à–µ–Ω–æ');return doc;}function findBestContent(doc){logDiagnostic('üîç –®—É–∫–∞—î–º–æ H1 –¥–ª—è –ø–æ—á–∞—Ç–∫—É –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü—ñ—ó...');const h1=doc.querySelector('h1');if(!h1){logDiagnostic('‚ùå H1 –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ, –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î–º–æ fallback');return findFallbackContent(doc);}logDiagnostic(`‚úÖ –ó–Ω–∞–π–¥–µ–Ω–æ H1: "${h1.textContent.trim()}"`);const container=document.createElement('div');container.appendChild(h1.cloneNode(true));let currentElement=h1;while(currentElement.nextElementSibling){currentElement=currentElement.nextElementSibling;container.appendChild(currentElement.cloneNode(true));logDiagnostic(`‚ûï –î–æ–¥–∞–Ω–æ –µ–ª–µ–º–µ–Ω—Ç –ø—ñ—Å–ª—è H1: ${currentElement.tagName}`);}let parentContainer=h1.parentElement;if(parentContainer&&parentContainer!==doc.body){let nextContainer=parentContainer;while(nextContainer.nextElementSibling){nextContainer=nextContainer.nextElementSibling;if(nextContainer.textContent.trim().length>50){container.appendChild(nextContainer.cloneNode(true));logDiagnostic(`‚ûï –î–æ–¥–∞–Ω–æ –Ω–∞—Å—Ç—É–ø–Ω–∏–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä: ${nextContainer.tagName}`);}}}logDiagnostic(`‚úÖ –°—Ç–≤–æ—Ä–µ–Ω–æ –∫–æ–Ω—Ç–µ–Ω—Ç –ø–æ—á–∏–Ω–∞—é—á–∏ –∑ H1: ${container.textContent.length} —Å–∏–º–≤–æ–ª—ñ–≤`);return container;}function findFallbackContent(doc){const contentSelectors=['article','main','.content','.post-content','.entry-content','#content'];let contentElement=null;let maxTextLength=0;for(const selector of contentSelectors){const elements=doc.querySelectorAll(selector);elements.forEach(element=>{const textLength=element.textContent.trim().length;logDiagnostic(`üîç Fallback –ø–µ—Ä–µ–≤—ñ—Ä–∫–∞ ${selector}: ${textLength} —Å–∏–º–≤–æ–ª—ñ–≤`);if(textLength>maxTextLength&&textLength>1000){maxTextLength=textLength;contentElement=element;}});}if(contentElement){logDiagnostic(`‚úÖ Fallback –≤–∏–±—Ä–∞–Ω–æ: ${maxTextLength} —Å–∏–º–≤–æ–ª—ñ–≤`);return contentElement;}logDiagnostic('üîÑ –û—Å—Ç–∞–Ω–Ω—ñ–π fallback: –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î–º–æ body');return doc.body;}function convertElement(element){let markdown='';let processedNodes=0;logDiagnostic(`üîÑ convertElement: ${element.childNodes.length} –¥–æ—á—ñ—Ä–Ω—ñ—Ö –≤—É–∑–ª—ñ–≤`);for(let i=0;i<element.childNodes.length;i++){const child=element.childNodes[i];if(child.nodeType===Node.TEXT_NODE){const text=child.textContent.replace(/\s+/g,' ').trim();if(text){markdown+=text+' ';processedNodes++;}}else if(child.nodeType===Node.ELEMENT_NODE){const elementResult=convertHTMLElement(child);markdown+=elementResult;if(elementResult)processedNodes++;}}logDiagnostic(`‚úÖ convertElement –∑–∞–≤–µ—Ä—à–µ–Ω–æ: ${processedNodes} –≤—É–∑–ª—ñ–≤, ${markdown.length} —Å–∏–º–≤–æ–ª—ñ–≤`);return markdown;}function convertHTMLElement(element){const tagName=element.tagName.toLowerCase();const text=element.textContent.trim();if(!text&&!['img','hr','br','table'].includes(tagName))return '';switch(tagName){case 'h1':return `\n# ${text}\n\n`;case 'h2':return `\n## ${text}\n\n`;case 'h3':return `\n### ${text}\n\n`;case 'h4':return `\n#### ${text}\n\n`;case 'h5':return `\n##### ${text}\n\n`;case 'h6':return `\n###### ${text}\n\n`;case 'p':return `\n${convertElement(element)}\n\n`;case 'strong':case 'b':return `**${text}
